#!/usr/bin/env bash
set -e

# Resolve the directory where this script lives
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Navigate to the frontend-react-js project root
PROJECT_ROOT="$(realpath "$SCRIPT_DIR/../../../frontend-react-js")"

# Check if the folder exists
if [ ! -d "$PROJECT_ROOT" ]; then
  echo "Error: frontend-react-js folder not found at $PROJECT_ROOT"
  exit 1
fi

printf "\033[1;35m == Building frontend-react-js Docker image... \033[0m\n(frontend dir=$PROJECT_ROOT) \n"

cd "$PROJECT_ROOT" || exit 1

docker build \
  --build-arg REACT_APP_BACKEND_URL="https://cruddur.jawid.me" \
  --build-arg REACT_APP_WEBSOCKET_URL="wss://0q8e5o27ac.execute-api.eu-west-2.amazonaws.com/prod" \
  --build-arg REACT_APP_AWS_REGION="eu-west-2" \
  --build-arg REACT_APP_USER_POOL_ID="eu-west-2_LdwGkYD5l" \
  --build-arg REACT_APP_USER_POOL_CLIENT_ID="20usdmenjqv0nmofrkldhdnnet" \
  --build-arg REACT_APP_AVATAR_API_URL="https://e5mz6glfej.execute-api.eu-west-2.amazonaws.com" \
  --build-arg REACT_APP_ASSETS_BASE_URL="https://assets.cruddur.jawid.me" \
  -t frontend-react-js \
  -f Dockerfile.prod \
  .


echo "Build completed."
