#!/usr/bin/bash
set -euo pipefail

source "$(dirname "$0")/../.env"

if [ "$ENV_TYPE" = "prod" ]; then
    printf "\033[1;35m == Testing RDS PostgreSQL connection... $AWS_RDS_PSQL_CONNECTION_DB \033[0m\n"
    URL="$AWS_RDS_PSQL_CONNECTION_DB"
else
    printf "\033[1;36m == Testing local PostgreSQL connection... \033[0m\n"
    URL="$CONNECTION_URL_DB"
fi

# Test connection
if psql "$URL" -c "SELECT version();" >/dev/null 2>&1; then
    echo "✅ Connection successful!"
else
    echo "❌ Connection failed!"
    exit 1
fi
