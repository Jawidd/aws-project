#! /usr/bin/env bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"

CFN_PATH="$ROOT_DIR/aws/cfn/networking/networking.yaml"

STACK_NAME="CrdNet"
REGION="eu-west-2"
BUCKET="cfn-artifacts-225442939245-eu-west-2"

echo "Deploying stack: $STACK_NAME"
echo "Template: $CFN_PATH"
echo "Region: $REGION"
echo "Bucket: $BUCKET"

aws cloudformation deploy \
  --stack-name "$STACK_NAME" \
  --s3-bucket "$BUCKET" \
  --s3-prefix networking \
  --region "$REGION" \
  --template-file "$CFN_PATH" \
  --tags group=cruddur-networking \
  --capabilities CAPABILITY_NAMED_IAM
